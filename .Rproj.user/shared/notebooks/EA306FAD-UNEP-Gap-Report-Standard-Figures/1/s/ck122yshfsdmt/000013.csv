"0",""
"0",""
"0","## Aggregate emissions data"
"0",""
"0","data_trend_luc <- data_edgar %>% "
"0","  filter(year>=1990) %>%  "
"0","  group_by(iso,country,year) %>% "
"0","  summarise(ghg=sum(value,na.rm=T)/1e6)"
"0",""
"0",""
"0","## Add Europe"
"0",""
"0","data_trend_luc <- data_trend_luc %>% "
"0","  rbind(.,data_trend_luc %>% "
"0","          left_join(.,cc_EU,by=""iso"") %>% "
"0","          filter(!is.na(EU)) %>% "
"0","          group_by(year) %>% "
"0","          summarise(iso=""EU27"",country=""European Union"",ghg=sum(ghg,na.rm=T)))"
"0",""
"0",""
"0","## Add LULUCF data"
"0",""
"0","data_luc <- read.xlsx(""sources/not public/LULUCF NGHGI data for UNEP 2024.xlsx"",startRow = 3)"
"0","data_luc <- data_luc %>% "
"0","  filter(LAND.CATEGORY==""LULUCF net"") %>% "
"0","  gather(year,luc,`2000`:`2023`) %>% "
"0","  mutate(year=as.numeric(year)) %>% "
"0","  select(iso=country.code,year,luc) %>% "
"0","  ungroup()"
"0",""
"0","# slot in tidy ghg inventory data"
"0","load(""../Tidy-GHG-Inventories/data/data_crts_v1.2.RData"")"
"0","data_crts <- data_crts %>% "
"0","  filter(sector_lv1==""Land use, land-use change and forestry"") %>% "
"0","  group_by(iso,year) %>% "
"0","  summarise(value=sum(value,na.rm=T)/1e6) %>% "
"0","  group_by(iso) %>% "
"0","  mutate(n=n()) %>% "
"0","  filter(n>=33) %>% "
"0","  select(-n) %>% "
"0","  ungroup()"
"0",""
"0","data_crts <- data_crts %>% "
"0","  spread(.,year,value) %>% "
"0","  gather(.,year,value,-iso) %>% "
"0","  arrange(iso,year) %>% "
"0","  group_by(iso) %>% "
"0","  fill(value, .direction = ""down"") %>% "
"0","  ungroup() %>% "
"0","  mutate(year=as.numeric(year))"
"0",""
"0","data_luc <- left_join(data_luc,data_crts)"
"2","[38;5;232mJoining with `by = join_by(iso, year)`[39m
"
"0","data_luc <- data_luc %>% "
"0","  mutate(luc=ifelse(is.na(value),luc,value))"
"0",""
"0",""
"0","data_trend_luc <- left_join(data_trend_luc,data_luc,by=join_by(iso,year))"
"0","data_trend_luc <- data_trend_luc %>% "
"0","  mutate(ghg_tot = ghg+luc) %>% "
"0","  filter(!is.na(ghg_tot))"
"0",""
"0",""
"0","## Adjust data for regression: all values must be non-zero, so if any in a series are negative, we sum the series by the lowest luc number"
"0",""
"0","data_trend_luc <- data_trend_luc %>%"
"0","  group_by(iso) %>%"
"0","  mutate(has_negative_ghg_tot = any(ghg_tot < 0, na.rm = TRUE),"
"0","         max_luc = min(luc, na.rm = TRUE),"
"0","         ghg_tot_adjusted = ifelse(has_negative_ghg_tot, ghg_tot - max_luc, ghg_tot)) %>%"
"0","  ungroup()"
"0",""
"0",""
"0","## Calculate the rate of change in ghg emissions the past x (10?) years, slice to last year"
"0",""
"0","data_trend_luc <- data_trend_luc %>% "
"0","  filter(year >= max(data_trend_luc$year)-5) %>% "
"0","  group_by(iso) %>% "
"0","  mutate(change_ghg_tot=growth_rate(year,ghg_tot_adjusted)$rate) %>% "
"0","  mutate(change_ghg_tot=change_ghg_tot*100) %>% "
"0","  mutate(change_ghg=growth_rate(year,ghg)$rate) %>% "
"0","  mutate(change_ghg=change_ghg*100)"
"0",""
"0",""
"0","## Filter to countries that only have some change in the luc data"
"0",""
"0","data_trend_luc <- data_trend_luc %>% "
"0","  group_by(iso) %>% "
"0","  mutate(include=ifelse(first(luc)==last(luc),0,1)) %>% "
"0","  filter(include==1)"
"0",""
"0",""
"0","## Join IPCC regions"
"0",""
"0","regions = read.xlsx(""../Codebase/IPCC_ar6_wgiii_region_classification.xlsx"",sheet=3)"
"0","regions$region_ar6_6 <- gsub(""Eastern Europe and West-Central Asia"",""E. Europe & W. Asia"",regions$region_ar6_6)"
"0","data_trend_luc <- data_trend_luc %>% "
"0","  left_join(.,regions %>% select(iso=ISO,region_ar6_6)) %>% "
"0","  mutate(region_ar6_6=ifelse(iso==""EU27"",""Developed Countries"",region_ar6_6))"
"2","[38;5;232mJoining with `by = join_by(iso)`[39m
"
"0","## Tidy"
"0",""
"0","data_trend_luc <- data_trend_luc %>% "
"0","  select(iso,country,region=region_ar6_6,year,ghg,luc,ghg_tot,change_ghg,change_ghg_tot) %>% "
"0","  arrange(iso,year)"
"0",""
"0",""
"0","## Prepare plot factors, colours, etc."
"0",""
"0","region_list <- unique(regions$region_ar6_6)"
"0","region_colours <- c(""Africa""=""#d45087ff"",""Developed Countries""=""#659cccff"",""Asia and developing Pacific""=""#e5b82cff"",""E. Europe & W. Asia""=""#ff9055ff"",""Latin America and Caribbean""=""#7dd396ff"",""Middle East""=""#17becfff"")"
"0","p <- vector(""list"", length(region_list))"
"0","country_highlight <- data_trend_luc %>% "
"0","  left_join(.,read.csv(""https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv"") %>%"
"0","              select(iso=Code) %>% "
"0","              add_row(iso=""EU27"") %>% "
"0","              mutate(G20=""1"")) %>% "
"0","  filter(G20==1) %>% "
"0","  filter(iso %in% c(""DEU"")) %>% "
"0","  filter(year==max(data_trend_luc$year))"
"2","[38;5;232mJoining with `by = join_by(iso)`[39m
"
"0","country_highlight <- data_trend_luc %>% "
"0","  mutate(difference=change_ghg-change_ghg_tot) %>% "
"0","  filter(abs(difference)>2) %>% "
"0","  filter(year==max(data_trend_luc$year))"
"0",""
"0",""
"0","## Plot"
"0",""
"0","plot <- data_trend_luc %>% "
"0","  filter(year==max(data_trend_luc$year)) %>%"
"0","  ggplot(.,aes(x=change_ghg_tot,y=change_ghg,label=country,fill=region)) +"
"0","  geom_hline(yintercept=0,colour=""#636363"")+"
"0","  geom_vline(xintercept=0,colour=""#636363"")+"
"0","  geom_abline(data = data.frame(change_ghg_tot=c(-10,10),change_ghg=c(-10,10)),colour=""#636363"") +"
"0","  geom_point(shape=21,size=2.75,colour=""#636363"") +"
"0","  "
"0","  annotate(""text"", x = 0.25, y = 9.5, label = ""Slower growth"",hjust=0,size=3.5) +"
"0","  annotate(""text"", x = 9.75, y = 0.75, label = ""Faster growth"",hjust=1,size=3.5) +"
"0","  annotate(""text"", x = -0.25, y = -9.25, label = ""Slower reductions"",hjust=1,size=3.5) +"
"0","  annotate(""text"", x = -9.75, y = -0.5, label = ""Faster reductions"",hjust=0,size=3.5) +"
"0","  "
"0","  # geom_label_repel("
"0","  #   data = country_highlight,"
"0","  #   aes(x = change_ghg_tot, y = change_ghg, label = country),"
"0","  #   size = 3.5,"
"0","  #   fill = ""white"","
"0","  #   alpha=0.8,"
"0","  #   label.size=NA,"
"0","  #   min.segment.length = 0,       # Always draw a segment"
"0","  #   segment.color = ""#636363"",     # Color of the line"
"0","  #   segment.size = 0.6,           # Thickness of the line"
"0","  #   box.padding = 1.25,            # Extra space around the label"
"0","  #   point.padding = 0.25,          # Extra space around the point"
"0","  #   max.overlaps = 125,force = 6,force_pull = 1# Allow a bit more overlaps if needed"
"0","  # ) +"
"0","  "
"0","  scale_fill_manual(values=region_colours) +"
"0","  theme_wl() +"
"0","  xlim(-10,10) +"
"0","  ylim(-10,10) +"
"0","  theme(legend.title=element_blank()) + "
"0","  labs(x=""Change in GHG emissions including LULUCF (%/yr, 5 yrs)"","
"0","       y=""Change in GHG emissions excluding LULUCF (%/yr, 5 yrs)"","
"0","       title = ""The influence of including the LULUCF sector on recent\nnational greenhouse gas emissions trends"","
"0","       caption=""\nâŒ‚ Data: EDGAR v10, UNFCCC, Tidy GHG Inventories  âŒ‚ Note: GWP100 AR6; only countries with recent LULUCF trend data shown"")"
"2","G2;H2;Warnungh: [38;5;232m`geom_abline()`: Ignoring `data` because `slope` and/or `intercept` were provided.[39mg
"
"0","plot"
