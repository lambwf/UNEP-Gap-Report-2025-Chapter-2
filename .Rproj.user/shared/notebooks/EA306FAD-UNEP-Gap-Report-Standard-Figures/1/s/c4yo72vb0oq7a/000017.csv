"0",""
"0","## Aggregate emissions data"
"0",""
"0","data_fossil <- data_edgar %>% "
"0","  group_by(year,sector_lv1,sector_lv2,sector_lv3,gas) %>% "
"0","  summarise(value=sum(value,na.rm=TRUE)/1e9)"
"0",""
"0",""
"0","## Classify fossil sources"
"0",""
"0","data_fossil <- data_fossil %>% "
"0","  mutate(category=ifelse(sector_lv1==""Energy"",""fossil"",NA)) %>% "
"0","  mutate(category=ifelse(gas==""F-gases"",""non-fossil"",category)) %>% "
"0","  mutate(category=ifelse(sector_lv3==""Cement (excl. carbonation)"",""non-fossil"",category)) %>% "
"0","  mutate(category=ifelse(sector_lv3==""Chemicals"" & is.na(category),""fossil"",category)) %>% "
"0","  mutate(category=ifelse(sector_lv3==""Metals"" & is.na(category),""fossil"",category)) %>% "
"0","  mutate(category=ifelse(sector_lv3==""Other (Industrial processes)"" & is.na(category),""fossil"",category)) %>% "
"0","  mutate(category=ifelse(sector_lv3==""Other (Indirect N2O and fossil fuel fires)"",""fossil"",category)) %>% "
"0","  mutate(category=ifelse(is.na(category),""non-fossil"",category))"
"0",""
"0",""
"0","## Aggregate land use change data"
"0",""
"0","data_total_luc <- data_gcb_luc %>% "
"0","  filter(country==""Global"") %>% "
"0","  mutate(value=value/1e9)"
"0",""
"0","# Add the GCB projection and join"
"0",""
"0","data_total_luc <- data_total_luc %>% "
"0","  add_row(year=2024,value=gcb_luc_projection) %>% "
"0","  select(-iso,-country) %>% "
"0","  mutate(category=""non-fossil"") %>% "
"0","  mutate(sector_lv1=""Land use change (LULUCF)"") %>% "
"0","  mutate(sector_lv2=""Land use change (LULUCF)"") %>% "
"0","  mutate(sector_lv3=""Land use change (LULUCF)"")"
"0",""
"0",""
"0","## Join land use change data, summarise categories"
"0",""
"0","data_fossil <- data_fossil %>% "
"0","  bind_rows(.,data_total_luc) %>% "
"0","  filter(year>=1990) %>% "
"0","  filter(year<=max(data_fossil$year)) %>% "
"0","  mutate(category=ifelse(category==""fossil"",""Fossil fuel emissions"","
"0","                         ""Non-fossil emissions"")) %>% "
"0","  group_by(category,year) %>% "
"0","  summarise(value=sum(value,na.rm=TRUE))"
"0",""
"0",""
"0","## Calculate the rate of change in the past year"
"0",""
"0","data_fossil_change <- data_fossil %>% "
"0","  rbind(.,data_fossil %>% "
"0","          group_by(year) %>% "
"0","          summarise(value=sum(value)) %>% "
"0","          mutate(category=""Total""))"
"0",""
"0",""
"0","# Arrange new levels"
"0",""
"0","data_fossil_change <- data_fossil_change %>% "
"0","  mutate(category = as.factor(category)) %>% "
"0","  mutate(category = fct_relevel(category,""Total"",""Fossil fuel emissions"",""Non-fossil emissions""))"
"0",""
"0",""
"0","# Calculate growth rates"
"0",""
"0","data_fossil_change <- data_fossil_change %>% "
"0","  filter(year >= max(data_fossil$year)-1) %>% "
"0","  group_by(category) %>% "
"0","  mutate(change=growth_rate(year,value)$rate) %>% "
"0","  mutate(change=change*100) %>% "
"0","  mutate(change=signif(change,2)) %>% "
"0","  mutate(change=ifelse(change>0,paste0(""+"",change,""%""),paste0(""-"",abs(change),""%""))) %>% "
"0","  filter(year==max(data_fossil$year)) %>%"
"0","  ungroup()"
"0",""
"0",""
"0","## Calculate the position of each label"
"0",""
"0","data_fossil_change <- data_fossil_change %>% "
"0","  left_join(.,data_fossil_change %>% "
"0","              filter(category!=""Total"") %>% "
"0","              arrange(desc(category)) %>% "
"0","              mutate(label_position=value) %>%"
"0","              mutate(label_position=cumsum(label_position)) %>% "
"0","              mutate(label_position=label_position-(value/2)) %>% "
"0","              select(category,label_position)) %>% "
"0","  mutate(label_position=ifelse(category==""Total"",value,label_position))"
"2","[38;5;232mJoining with `by = join_by(category)`[39m
"
"0","data_fossil_change <- data_fossil_change %>% "
"0","  mutate(value=round(value,1)) %>% "
"0","  mutate(label=paste0(category,"": "",value,"" "",change,""""))"
"0",""
"0",""
"0",""
"0",""
"0","p1 <- data_fossil %>% ggplot(.,aes(x=year,y=value,fill=category)) +"
"0","  geom_col(color=""#252525"",linewidth=0.25, width=1) +"
"0","  theme_wl_bar_trend() +"
"0","  scale_fill_manual(values=c(""Fossil fuel emissions""=""#659cccff"","
"0","                             ""Non-fossil emissions""=""#ff9055ff"")) +"
"0","  scale_y_continuous(breaks=c(0,20,40,60),limits=c(0,70)) +"
"0","  scale_x_continuous(breaks=c(1990,2000,2010,2020,max(data_fossil$year)),"
"0","                     expand = expansion(mult = c(0.05, 0.01))) +"
"0","  theme(axis.title = element_blank(),"
"0","        legend.position = ""none"") +"
"0","  labs(title=""Total net greenhouse gas emissions by source"","
"0","       subtitle=bquote(paste(""GtCO""[2], ""e/year"")),"
"0","       caption=""âŒ‚ UNEP Emissions Gap Report 2025    âŒ‚ Data: EDGAR v10, GCB 2024    âŒ‚ Note: GWP100 AR6 \nâŒ‚ Fossil fuel emissions are from the production, combustion and use of coal, oil and gas \nâŒ‚ Non-fossil emissions are from land use change (bookkeeping conventions), agriculture, f-gases and some industrial processes"")"
"0",""
"0",""
"0","p2 <- data_fossil_change %>% "
"0","  ggplot(.,aes(x=1,y=label_position,label=str_wrap(label,22),color=category)) +"
"0","  geom_text_repel("
"0","    hjust=0,"
"0","    direction = ""y"","
"0","    point.size = NA,"
"0","    size=3.5,"
"0","    show.legend = FALSE,"
"0","    min.segment.length = Inf,"
"0","    box.padding = 0.2,"
"0","    force = 0.1) +"
"0","  annotation_custom(grob = textGrob(""Emissions in 2024,\n1 year change:"","
"0","                                    x = unit(0.03, ""npc""), y = unit(0.88, ""npc""),hjust = 0, vjust = 0,"
"0","                                    gp = gpar(col = ""#636363"", fontsize = 10, lineheight=0.9)),"
"0","                    xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf) +"
"0","  scale_colour_manual(values=c(""Fossil fuel emissions""=""#659cccff"","
"0","                               ""Non-fossil emissions""=""#ff9055ff"")) +"
"0","  scale_y_continuous(limits = c(0,70)) +"
"0","  scale_x_continuous(expand = expansion(mult = c(0, 0.05))) +"
"0","  theme_wl_empty()"
"0",""
"0","plot <- p1 + p2 + plot_layout(widths=c(5,1.55))"
