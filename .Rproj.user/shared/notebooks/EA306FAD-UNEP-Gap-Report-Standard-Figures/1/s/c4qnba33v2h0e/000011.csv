"0",""
"0",""
"0","## Aggregate emissions data"
"0",""
"0","data_percap <- data_edgar %>% "
"0","  filter(year>=1990) %>% "
"0","  group_by(iso,country,year) %>% "
"0","  summarise(ghg=sum(value,na.rm=T))"
"0",""
"0",""
"0","## Join population, filter out NAs"
"0",""
"0","data_percap <- data_percap %>% "
"0","  left_join(.,data_wdi_pop %>% select(iso,year,population),by=join_by(""iso"",""year"")) %>% "
"0","  filter(!is.na(population))"
"0",""
"0",""
"0","## Add Europe, calculate per capita emissions"
"0",""
"0","data_percap <- data_percap %>% "
"0","  left_join(.,cc_EU,by=""iso"") %>% "
"0","  mutate(iso=ifelse(!is.na(EU),""EU27"",iso)) %>% "
"0","  mutate(country=ifelse(!is.na(EU),""European Union"",country)) %>% "
"0","  group_by(iso,country,year) %>% "
"0","  summarise(ghg=sum(ghg),population=sum(population)) %>% "
"0","  mutate(ghg_pc=ghg/population)"
"0",""
"0",""
"0","## Calculate the rate of change in ghg emissions the past 3 years, slice to last year"
"0",""
"0","data_percap <- data_percap %>% "
"0","  filter(year >= max(data_percap$year)-2) %>% "
"0","  group_by(iso) %>% "
"0","  mutate(change_3yr=growth_rate(year,ghg)$rate) %>% "
"0","  mutate(change_3yr=change_3yr*100) %>% "
"0","  filter(year==max(data_percap$year))"
"0",""
"0",""
"0","## Join IPCC regions"
"0",""
"0","regions = read.xlsx(""../Codebase/IPCC_ar6_wgiii_region_classification.xlsx"",sheet=3)"
"0","regions$region_ar6_6 <- gsub(""Eastern Europe and West-Central Asia"",""E. Europe & W. Asia"",regions$region_ar6_6)"
"0","data_percap <- data_percap %>% "
"0","  left_join(.,regions %>% select(iso=ISO,region_ar6_6)) %>% "
"0","  mutate(region_ar6_6=ifelse(iso==""EU27"",""Developed Countries"",region_ar6_6))"
"2","[38;5;232mJoining with `by = join_by(iso)`[39m
"
"0","## Tidy"
"0",""
"0","data_percap <- data_percap %>% "
"0","  select(iso,country,region=region_ar6_6,year,everything())"
"0",""
"0",""
"0","## Prepare plot factors, colours, etc."
"0",""
"0","region_list <- unique(regions$region_ar6_6)"
"0","region_colours <- c(""Africa""=""#d45087ff"",""Developed Countries""=""#659cccff"",""Asia and developing Pacific""=""#e5b82cff"",""E. Europe & W. Asia""=""#ff9055ff"",""Latin America and Caribbean""=""#7dd396ff"",""Middle East""=""#17becfff"")"
"0","p <- vector(""list"", length(region_list))"
"0","country_highlight <- data_percap %>% "
"0","  left_join(.,read.csv(""https://raw.githubusercontent.com/openclimatedata/countrygroups/main/data/g20.csv"") %>%"
"0","              select(iso=Code) %>% "
"0","              add_row(iso=""EU27"") %>% "
"0","              mutate(G20=""1"")) %>% "
"0","  filter(G20==1) %>% "
"0","  filter(iso %in% c(""CHN"",""USA"",""IND"",""EU27"",""RUS"",""BRA""))"
"2","[38;5;232mJoining with `by = join_by(iso)`[39m
"
"0","## Plot"
"0",""
"0","for (i in 1:length(region_list)) {"
"0","  "
"0","  fill_colour <- adjustcolor(region_colours[i], alpha.f = 0.6)"
"0","  "
"0","  p[[i]] <- ggplot(data_percap,aes(x=ghg_pc,y=change_3yr,label=country)) +"
"0","    geom_hline(yintercept=0,colour=""#636363"")+"
"0","    geom_point(data=data_percap %>% filter(region!=region_list[i]),shape=21,size=2,colour=""#bdbdbd"",fill=""#bdbdbd"") +"
"0","    geom_point(data=data_percap %>% filter(region==region_list[i]),shape=21,size=2.75,colour=""#636363"",fill=region_colours[i]) +"
"0","    geom_label_repel("
"0","      data = country_highlight %>% filter(region == region_list[i]),"
"0","      aes(x = ghg_pc, y = change_3yr, label = country),"
"0","      size = 3.5,"
"0","      fill = ""white"","
"0","      alpha=0.8,"
"0","      label.size=NA,"
"0","      min.segment.length = 0,       # Always draw a segment"
"0","      segment.color = ""#636363"",     # Color of the line"
"0","      segment.size = 0.6,           # Thickness of the line"
"0","      box.padding = 1.25,            # Extra space around the label"
"0","      point.padding = 0.25,          # Extra space around the point"
"0","      max.overlaps = 125,force = 6,force_pull = 1,nudge_y = 1,nudge_x=3# Allow a bit more overlaps if needed"
"0","    ) +"
"0","    theme_wl() +"
"0","    xlim(0,30) +"
"0","    ylim(-12,12) +"
"0","    theme(legend.position=""none"") +"
"0","    labs(subtitle=region_list[i],"
"0","         x=""Per capita greenhouse gas emissions (tCO2e/person)"","
"0","         y=""Change in total greenhouse gas emissions from 2022-2024 (%)"")"
"0","  "
"0","}"
"0",""
"0","combined_plot <- wrap_plots(p)"
"0",""
"0","# Remove x-axis for plots 1, 2, and 3"
"0","combined_plot[[1]] <- combined_plot[[1]] + theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank(),axis.title.y = element_text(hjust = 1.05)) +"
"0","  labs(title=""Per capita emissions vs change in total emissions"")"
"0","combined_plot[[2]] <- combined_plot[[2]] + theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank())"
"0","combined_plot[[3]] <- combined_plot[[3]] + theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank())"
"0",""
"0","# Remove y-axis for plots 2, 3, 5, and 6"
"0","combined_plot[[2]] <- combined_plot[[2]] + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())"
"0","combined_plot[[3]] <- combined_plot[[3]] + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())"
"0","combined_plot[[5]] <- combined_plot[[5]] + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())"
"0","combined_plot[[6]] <- combined_plot[[6]] + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank(),axis.title.x = element_blank())"
"0",""
"0","combined_plot[[4]] <- combined_plot[[4]] + theme(axis.title.x = element_blank(),axis.title.y = element_blank()) + labs(caption=""\nâŒ‚ Data: EDGAR v10, World Bank \nâŒ‚ Note: GWP100 AR6; land use change (LULUCF) emissions and removals excluded; 3 countries above 30tCO2e/capita excluded\n (Qatar, Bahrain, Kuwait); top 6 emitters by total GHG emissions labelled"")"
"0",""
"0","combined_plot"
