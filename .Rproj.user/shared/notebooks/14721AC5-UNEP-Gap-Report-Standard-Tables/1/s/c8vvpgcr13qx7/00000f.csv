"0",""
"0",""
"0","## Aggregate emissions data"
"0",""
"0","data_total <- data_edgar %>% "
"0","  group_by(year,gas) %>% "
"0","  summarise(value=sum(value,na.rm=T)/1e9)"
"0",""
"0","data_total_luc <- data_gcb_luc %>% "
"0","  filter(country==""Global"") %>% "
"0","  mutate(value=value/1e9)"
"0",""
"0",""
"0","# Add the GCB projection and join"
"0",""
"0","data_total_luc <- data_total_luc %>% "
"0","  add_row(year=2024,value=gcb_luc_projection)"
"0",""
"0","data_total_luc <- data_total_luc %>% "
"0","  mutate(gas=""CO2 LULUCF (Bookkeeping)"") %>% "
"0","  select(-iso,-country)"
"0",""
"0","data_total <- rbind(data_total,data_total_luc) %>% "
"0","  filter(year>=1990)"
"0",""
"0",""
"0","## Add the inventory LULUCF and join"
"0",""
"0","data_total_inv_luc <- read.csv(""sources/not public/timeseries_JRC.csv"") %>% "
"0","  filter(ISO3==""WRD"",Category==""LULUCF"",Version==""V3.0 (NGHGI 2025)"") %>% "
"0","  rename(year=Year,value=CFluxes_yr) %>% "
"0","  group_by(year) %>% "
"0","  summarise(value=sum(value,na.rm=T)/1000) %>% "
"0","  mutate(gas=""CO2 LULUCF (Inventory)"")"
"0","  "
"0","data_total <- rbind(data_total,data_total_inv_luc)"
"0",""
"0",""
"0","######### format table 1"
"0",""
"0","# Select time frames for reporting (2010s, 2021, 2022, 2023)"
"0",""
"0","data_table <- data_total %>% "
"0","  mutate(cut=ifelse(year>=2010 & year <=2019,""2010-2019"",NA)) %>% "
"0","  mutate(cut=ifelse(year==2022,""2022"",cut)) %>% "
"0","  mutate(cut=ifelse(year==2023,""2023"",cut)) %>% "
"0","  mutate(cut=ifelse(year==2024,""2024"",cut))"
"0",""
"0",""
"0","# Calculate total emissions by gas in each reporting year"
"0",""
"0","data_table <- data_table %>% "
"0","  filter(!is.na(cut)) %>% "
"0","  group_by(gas,cut) %>% "
"0","  summarise(value=mean(value))"
"0",""
"0",""
"0","# Calculate uncertainties for individual gases following the IPCC AR6 WG3 convention"
"0",""
"0","uncertainties = data.frame(gas=c(""CO2 Fossil"",""CO2 LULUCF (Bookkeeping)"",""CO2 LULUCF (Inventory)"",""CH4"",""N2O"",""F-gases""),uncertainty=c(0.08,0.7,0.7,0.3,0.6,0.3))"
"0",""
"0","data_table <- left_join(data_table,uncertainties,by=""gas"")"
"0","data_table <- data_table %>% "
"0","  mutate(uncertainty_abs=value*uncertainty) %>% "
"0","  mutate(value=ifelse(gas==""CO2 Fossil"",signif(value,3),signif(value,2))) %>% "
"0","  mutate(uncertainty_abs=signif(uncertainty_abs,2))"
"0",""
"0","data_table <- data_table %>% "
"0","  mutate(value=paste0(value,""Â±"",uncertainty_abs))"
"0",""
"0",""
"0","# Calculate total GHG emissions in the selected time frames, excluding inventory LULUCF"
"0",""
"0",""
"0","data_table_ghgs <- data_total %>% "
"0","  mutate(cut=ifelse(year>=2010 & year <=2019,""2010-2019"",NA)) %>% "
"0","  mutate(cut=ifelse(year==2022,""2022"",cut)) %>% "
"0","  mutate(cut=ifelse(year==2023,""2023"",cut)) %>% "
"0","  mutate(cut=ifelse(year==2024,""2024"",cut)) %>% "
"0","  filter(!is.na(cut)) %>% "
"0","  group_by(gas,cut) %>% "
"0","  summarise(value=mean(value))"
"0",""
"0",""
"0","data_table_ghgs <- left_join(data_table_ghgs,uncertainties,by=""gas"") %>% "
"0","  filter(gas!=""CO2 LULUCF (Inventory)"") %>% "
"0","  group_by(cut,gas,uncertainty) %>% "
"0","  summarise(value=mean(value,na.rm=TRUE))"
"0",""
"0","# Calculate uncertainty ranges for total GHG emissions, following IPCC AR6 WG3 convention"
"0",""
"0","data_table_ghgs <- data_table_ghgs %>% "
"0","  mutate(uncertainty_abs=value*uncertainty) %>% "
"0","  mutate(uncertainty_abs=uncertainty_abs^2) %>% "
"0","  group_by(cut) %>% "
"0","  summarise(value=sum(value,na.rm=TRUE),"
"0","            uncertainty_abs=sqrt(sum(uncertainty_abs,na.rm=TRUE)))"
"0",""
"0","data_table_ghgs <- data_table_ghgs %>% "
"0","  mutate(gas=""GHG"") %>% "
"0","  mutate(value=signif(value,3)) %>% "
"0","  mutate(uncertainty_abs=signif(uncertainty_abs,2)) %>% "
"0","  mutate(value=paste0(value,""Â±"",uncertainty_abs))"
"0",""
"0",""
"0","# Join data by gas and GHG, tidy up variables"
"0",""
"0","data_table <- rbind(data_table,data_table_ghgs)"
"0","data_table <- data_table %>% "
"0","  select(-uncertainty,-uncertainty_abs)"
"0",""
"0",""
"0","# Arrange factor levels"
"0",""
"0","data_table$gas <- as.factor(data_table$gas)"
"0","data_table$gas <- fct_relevel(data_table$gas,""GHG"",""CO2 Fossil"",""CO2 LULUCF (Bookkeeping)"",""CO2 LULUCF (Inventory)"",""CH4"",""N2O"",""F-gases"")"
"0","data_table <- spread(data_table,cut,value)"
"0",""
"0",""
"0","########### table of totals"
"0",""
"0","data_total <- data_total %>% "
"0","  rbind(.,data_total %>% "
"0","              filter(gas!=""CO2 LULUCF (Inventory)"") %>% "
"0","              group_by(year) %>%"
"0","              summarise(value=sum(value,na.rm=TRUE)) %>% "
"0","              mutate(gas=""GHG""))"
"0",""
"0",""
"0","# Arrange factor levels"
"0",""
"0","data_total$gas <- as.factor(data_total$gas)"
"0","data_total$gas <- fct_relevel(data_total$gas,""GHG"",""CO2 Fossil"",""CO2 LULUCF (Bookkeeping)"",""CH4"",""N2O"",""F-gases"",""CO2 LULUCF (Inventory)"")"
"0",""
"0",""
"0","# Spread data and calculate relative and absolute changes in the latest year"
"0",""
"0","data_total_change <- data_total %>% "
"0","  filter(year %in% c(2023,2024)) %>% "
"0","  arrange(gas,year) %>% "
"0","  group_by(gas) %>% "
"0","  summarise(change_2023_2024_abs=last(value)-first(value),"
"0","            change_2023_2024_rel=growth_rate(year,value)$rate) %>% "
"0","  mutate(change_2023_2024_rel=paste0(round(change_2023_2024_rel*100,1),""%""))"
"0",""
"0","data_total <- data_total %>% "
"0","  spread(year,value) %>% "
"0","  left_join(.,data_total_change)"
"2","[38;5;232mJoining with `by = join_by(gas)`[39m
"
"0","# Add a blank row to separate values not in the total (inventory LULUCF and CO2 excl. carbonation)"
"0",""
"0","data_total <- rbind(data_total %>%"
"0","                             ungroup() %>%"
"0","                             filter(!gas %in% c(""CO2 LULUCF (Inventory)"")) %>%"
"0","                             add_row(),"
"0","                    data_total %>% filter(gas %in% c(""CO2 LULUCF (Inventory)"")))"
"0",""
"0","data_total <- data_total %>% "
"0","  mutate(change_2023_2024_abs=ifelse(gas==""CO2 LULUCF (Inventory)"",NA,change_2023_2024_abs)) %>% "
"0","  mutate(change_2023_2024_rel=ifelse(gas==""CO2 LULUCF (Inventory)"",NA,change_2023_2024_rel))"
"0",""
"0",""
"0","######################## Save data to excel file"
"0",""
"0","wb <- createWorkbook()"
"0","options(""openxlsx.numFmt"" = ""0.00"")"
"0","addWorksheet(wb,""table_1"")"
"0","writeData(wb, sheet = ""table_1"", data_table, colNames = T, rowNames = F)"
"0",""
"0",""
"0",""
"0",""
"0","pct = createStyle(numFmt=""0.0%"")"
"0",""
"0","addWorksheet(wb,""total_by_gas"")"
"0","writeData(wb, sheet = ""total_by_gas"", data_total, colNames = T, rowNames = F)"
"0",""
"0","addStyle(wb, ""total_by_gas"",style=pct,"
"0","         cols=length(data_total),"
"0","         rows=1:length(data_total$gas)+1,"
"0","         gridExpand=TRUE)"
"0",""
"0",""
"0",""
"0","## Table of total emissions by sector (for data file)"
"0",""
"0",""
"0","# Calculate total emissions by sector"
"0",""
"0","data_sectors <- data_edgar %>%"
"0","  filter(year>=1990) %>%"
"0","  group_by(sector_lv1,sector_lv2,sector_lv3,year) %>%"
"0","  summarise(value=sum(value,na.rm=TRUE)/1e9)"
"0",""
"0",""
"0","# Spread and calculate relative and absolute emission changes in the latest year"
"0",""
"0",""
"0","data_sectors_change <- data_sectors %>% "
"0","  filter(year %in% c(2023,2024)) %>% "
"0","  arrange(sector_lv1,sector_lv2,sector_lv3,year) %>% "
"0","  group_by(sector_lv1,sector_lv2,sector_lv3) %>% "
"0","  summarise(change_2023_2024_abs=last(value)-first(value),"
"0","            change_2023_2024_rel=growth_rate(year,value)$rate) %>% "
"0","  mutate(change_2023_2024_rel=paste0(round(change_2023_2024_rel*100,1),""%""))"
"0",""
"0","data_sectors <- data_sectors %>% "
"0","  spread(year,value) %>% "
"0","  left_join(.,data_sectors_change)"
"2","[38;5;232mJoining with `by = join_by(sector_lv1, sector_lv2, sector_lv3)`[39m
"
"0","# Write to excel file"
"0",""
"0","addWorksheet(wb,""total_by_sector"")"
"0","writeData(wb, sheet = ""total_by_sector"", data_sectors, colNames = T, rowNames = F)"
"0",""
"0","addStyle(wb, ""total_by_sector"",style=pct,"
"0","         cols=length(data_sectors),"
"0","         rows=2:length(data_sectors$sector_lv1)+1,"
"0","         gridExpand=TRUE)"
"0",""
"0",""
"0",""
"0",""
"0",""
"0",""
"0","# Save excel file"
"0",""
"0","saveWorkbook(wb,paste0(""results/UNEP-Gap-Report-2025-Chapter-2-Data-Global.xlsx""),overwrite=T)"
"0",""
